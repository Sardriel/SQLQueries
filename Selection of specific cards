  SELECT  Count(Userproviderkey) as pocetKaretNaUcet, email, number, DefaultCustomerProfiles.Name
  FROM [www.mhdrk.sk].[dbo].[Cards] 
  JOIN  [www.mhdrk.sk].[dbo].[AspNetUsers] ON ASPNETUSERS.id = CARDS.UserProviderKey
  JOIN  [www.mhdrk.sk].[dbo].CardDiscounts ON CARDDISCOUNTS.cardid = CARDS.id
  JOIN  [www.mhdrk.sk].[dbo].DefaultCustomerProfiles ON DEFAULTCUSTOMERPROFILES.Id = CARDDISCOUNT.CustomerProfileId
  WHERE 

  email in ('') and 

  CARDS.state NOT IN ( '7', '3', '2') and 
  CARDS.ExpirationUTC !< GETDATE() and 
  CARDDISCOUNTS.State = '2'
  
  
  
  
  -----and CARDS.Borndate > '2006-06-02 00:00:00.000'
  Group by email, number, DEFAULTCUSTOMERPROFILES.Name  order by email 
